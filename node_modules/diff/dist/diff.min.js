((global,factory)=>{"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).Diff={})})(this,function(exports){var extendStatics,Diff=(()=>{function Diff(){}return Diff.prototype.diff=function(oldStr,newStr,options){"function"==typeof(options=void 0===options?{}:options)?(callback=options,options={}):"callback"in options&&(callback=options.callback);var callback,oldStr=this.castInput(oldStr,options),newStr=this.castInput(newStr,options),oldStr=this.removeEmpty(this.tokenize(oldStr,options)),newStr=this.removeEmpty(this.tokenize(newStr,options));return this.diffWithOptionsObj(oldStr,newStr,options,callback)},Diff.prototype.diffWithOptionsObj=function(oldTokens,newTokens,options,callback){var _this=this,done=function(value){if(value=_this.postProcess(value,options),!callback)return value;setTimeout(function(){callback(value)},0)},newLen=newTokens.length,oldLen=oldTokens.length,editLength=1,maxEditLength=newLen+oldLen,_a=(null!=options.maxEditLength&&(maxEditLength=Math.min(maxEditLength,options.maxEditLength)),null!=(_a=options.timeout)?_a:1/0),abortAfterTimestamp=Date.now()+_a,bestPath=[{oldPos:-1,lastComponent:void 0}],newPos=this.extractCommon(bestPath[0],newTokens,oldTokens,0,options);if(bestPath[0].oldPos+1>=oldLen&&newLen<=newPos+1)return done(this.buildValues(bestPath[0].lastComponent,newTokens,oldTokens));function execEditLength(){for(var diagonalPath=Math.max(minDiagonalToConsider,-editLength);diagonalPath<=Math.min(maxDiagonalToConsider,editLength);diagonalPath+=2){var basePath=void 0,removePath=bestPath[diagonalPath-1],addPath=bestPath[diagonalPath+1],canAdd=(removePath&&(bestPath[diagonalPath-1]=void 0),!1),addPathNewPos=(addPath&&(addPathNewPos=addPath.oldPos-diagonalPath,canAdd=addPath&&0<=addPathNewPos&&addPathNewPos<newLen),removePath&&removePath.oldPos+1<oldLen);if(canAdd||addPathNewPos){if(basePath=!addPathNewPos||canAdd&&removePath.oldPos<addPath.oldPos?_this.addToPath(addPath,!0,!1,0,options):_this.addToPath(removePath,!1,!0,1,options),newPos=_this.extractCommon(basePath,newTokens,oldTokens,diagonalPath,options),basePath.oldPos+1>=oldLen&&newLen<=newPos+1)return done(_this.buildValues(basePath.lastComponent,newTokens,oldTokens))||!0;(bestPath[diagonalPath]=basePath).oldPos+1>=oldLen&&(maxDiagonalToConsider=Math.min(maxDiagonalToConsider,diagonalPath-1)),newLen<=newPos+1&&(minDiagonalToConsider=Math.max(minDiagonalToConsider,diagonalPath+1))}else bestPath[diagonalPath]=void 0}editLength++}var minDiagonalToConsider=-1/0,maxDiagonalToConsider=1/0;if(callback)!function exec(){setTimeout(function(){if(maxEditLength<editLength||Date.now()>abortAfterTimestamp)return callback(void 0);execEditLength()||exec()},0)}();else for(;editLength<=maxEditLength&&Date.now()<=abortAfterTimestamp;){var ret=execEditLength();if(ret)return ret}},Diff.prototype.addToPath=function(path,added,removed,oldPosInc,options){var last=path.lastComponent;return last&&!options.oneChangePerToken&&last.added===added&&last.removed===removed?{oldPos:path.oldPos+oldPosInc,lastComponent:{count:last.count+1,added:added,removed:removed,previousComponent:last.previousComponent}}:{oldPos:path.oldPos+oldPosInc,lastComponent:{count:1,added:added,removed:removed,previousComponent:last}}},Diff.prototype.extractCommon=function(basePath,newTokens,oldTokens,diagonalPath,options){for(var newLen=newTokens.length,oldLen=oldTokens.length,oldPos=basePath.oldPos,newPos=oldPos-diagonalPath,commonCount=0;newPos+1<newLen&&oldPos+1<oldLen&&this.equals(oldTokens[oldPos+1],newTokens[newPos+1],options);)newPos++,oldPos++,commonCount++,options.oneChangePerToken&&(basePath.lastComponent={count:1,previousComponent:basePath.lastComponent,added:!1,removed:!1});return commonCount&&!options.oneChangePerToken&&(basePath.lastComponent={count:commonCount,previousComponent:basePath.lastComponent,added:!1,removed:!1}),basePath.oldPos=oldPos,newPos},Diff.prototype.equals=function(left,right,options){return options.comparator?options.comparator(left,right):left===right||!!options.ignoreCase&&left.toLowerCase()===right.toLowerCase()},Diff.prototype.removeEmpty=function(array){for(var ret=[],i=0;i<array.length;i++)array[i]&&ret.push(array[i]);return ret},Diff.prototype.castInput=function(value,options){return value},Diff.prototype.tokenize=function(value,options){return Array.from(value)},Diff.prototype.join=function(chars){return chars.join("")},Diff.prototype.postProcess=function(changeObjects,options){return changeObjects},Object.defineProperty(Diff.prototype,"useLongestToken",{get:function(){return!1},enumerable:!1,configurable:!0}),Diff.prototype.buildValues=function(lastComponent,newTokens,oldTokens){for(var nextComponent,components=[];lastComponent;)components.push(lastComponent),nextComponent=lastComponent.previousComponent,delete lastComponent.previousComponent,lastComponent=nextComponent;components.reverse();for(var componentLen=components.length,componentPos=0,newPos=0,oldPos=0;componentPos<componentLen;componentPos++){var value,component=components[componentPos];component.removed?(component.value=this.join(oldTokens.slice(oldPos,oldPos+component.count)),oldPos+=component.count):(!component.added&&this.useLongestToken?(value=(value=newTokens.slice(newPos,newPos+component.count)).map(function(value,i){i=oldTokens[oldPos+i];return i.length>value.length?i:value}),component.value=this.join(value)):component.value=this.join(newTokens.slice(newPos,newPos+component.count)),newPos+=component.count,component.added||(oldPos+=component.count))}return components},Diff})(),__extends$6=(extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)},function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}),characterDiff=new((_super=>{function CharacterDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends$6(CharacterDiff,_super),CharacterDiff})(Diff));function longestCommonPrefix(str1,str2){for(var i=0;i<str1.length&&i<str2.length;i++)if(str1[i]!=str2[i])return str1.slice(0,i);return str1.slice(0,i)}function longestCommonSuffix(str1,str2){var i;if(!str1||!str2||str1[str1.length-1]!=str2[str2.length-1])return"";for(i=0;i<str1.length&&i<str2.length;i++)if(str1[str1.length-(i+1)]!=str2[str2.length-(i+1)])return str1.slice(-i);return str1.slice(-i)}function replacePrefix(string,oldPrefix,newPrefix){if(string.slice(0,oldPrefix.length)!=oldPrefix)throw Error("string ".concat(JSON.stringify(string)," doesn't start with prefix ").concat(JSON.stringify(oldPrefix),"; this is a bug"));return newPrefix+string.slice(oldPrefix.length)}function replaceSuffix(string,oldSuffix,newSuffix){if(!oldSuffix)return string+newSuffix;if(string.slice(-oldSuffix.length)!=oldSuffix)throw Error("string ".concat(JSON.stringify(string)," doesn't end with suffix ").concat(JSON.stringify(oldSuffix),"; this is a bug"));return string.slice(0,-oldSuffix.length)+newSuffix}function removePrefix(string,oldPrefix){return replacePrefix(string,oldPrefix,"")}function removeSuffix(string,oldSuffix){return replaceSuffix(string,oldSuffix,"")}function maximumOverlap(string1,string2){return string2.slice(0,((a,b)=>{var startA=0,endB=(a.length>b.length&&(startA=a.length-b.length),b.length),map=(a.length<b.length&&(endB=a.length),Array(endB)),k=0;map[0]=0;for(var j=1;j<endB;j++){for(b[j]==b[k]?map[j]=map[k]:map[j]=k;0<k&&b[j]!=b[k];)k=map[k];b[j]==b[k]&&k++}k=0;for(var i=startA;i<a.length;i++){for(;0<k&&a[i]!=b[k];)k=map[k];a[i]==b[k]&&k++}return k})(string1,string2))}function trailingWs(string){for(var i=string.length-1;0<=i&&string[i].match(/\s/);i--);return string.substring(i+1)}function leadingWs(string){string=string.match(/^\s*/);return string?string[0]:""}var __extends$5=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),extendedWordChars="a-zA-Z0-9_\\u{C0}-\\u{FF}\\u{D8}-\\u{F6}\\u{F8}-\\u{2C6}\\u{2C8}-\\u{2D7}\\u{2DE}-\\u{2FF}\\u{1E00}-\\u{1EFF}",tokenizeIncludingWhitespace=new RegExp("[".concat(extendedWordChars,"]+|\\s+|[^").concat(extendedWordChars,"]"),"ug"),wordDiff=new((_super=>{function WordDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends$5(WordDiff,_super),WordDiff.prototype.equals=function(left,right,options){return options.ignoreCase&&(left=left.toLowerCase(),right=right.toLowerCase()),left.trim()===right.trim()},WordDiff.prototype.tokenize=function(value,options){var parts;if((options=void 0===options?{}:options).intlSegmenter){options=options.intlSegmenter;if("word"!=options.resolvedOptions().granularity)throw new Error('The segmenter passed must have a granularity of "word"');parts=Array.from(options.segment(value),function(segment){return segment.segment})}else parts=value.match(tokenizeIncludingWhitespace)||[];var tokens=[],prevPart=null;return parts.forEach(function(part){/\s/.test(part)?tokens.push(null==prevPart?part:tokens.pop()+part):null!=prevPart&&/\s/.test(prevPart)?tokens.push(tokens[tokens.length-1]==prevPart?tokens.pop()+part:prevPart+part):tokens.push(part),prevPart=part}),tokens},WordDiff.prototype.join=function(tokens){return tokens.map(function(token,i){return 0==i?token:token.replace(/^\s+/,"")}).join("")},WordDiff.prototype.postProcess=function(changes,options){var lastKeep,insertion,deletion;return changes&&!options.oneChangePerToken&&(deletion=insertion=lastKeep=null,changes.forEach(function(change){change.added?insertion=change:deletion=change.removed?change:((insertion||deletion)&&dedupeWhitespaceInChangeObjects(lastKeep,deletion,insertion,change),lastKeep=change,insertion=null)}),insertion||deletion)&&dedupeWhitespaceInChangeObjects(lastKeep,deletion,insertion,null),changes},WordDiff})(Diff));function dedupeWhitespaceInChangeObjects(startKeep,deletion,insertion,endKeep){var oldWsPrefix,oldWsSuffix,newWsSuffix,newWsPrefix,ws,overlap;deletion&&insertion?(oldWsPrefix=leadingWs(deletion.value),oldWsSuffix=trailingWs(deletion.value),newWsPrefix=leadingWs(insertion.value),newWsSuffix=trailingWs(insertion.value),startKeep&&(oldWsPrefix=longestCommonPrefix(oldWsPrefix,newWsPrefix),startKeep.value=replaceSuffix(startKeep.value,newWsPrefix,oldWsPrefix),deletion.value=removePrefix(deletion.value,oldWsPrefix),insertion.value=removePrefix(insertion.value,oldWsPrefix)),endKeep&&(newWsPrefix=longestCommonSuffix(oldWsSuffix,newWsSuffix),endKeep.value=replacePrefix(endKeep.value,newWsSuffix,newWsPrefix),deletion.value=removeSuffix(deletion.value,newWsPrefix),insertion.value=removeSuffix(insertion.value,newWsPrefix))):insertion?(startKeep&&(ws=leadingWs(insertion.value),insertion.value=insertion.value.substring(ws.length)),endKeep&&(ws=leadingWs(endKeep.value),endKeep.value=endKeep.value.substring(ws.length))):startKeep&&endKeep?(oldWsPrefix=leadingWs(endKeep.value),oldWsSuffix=leadingWs(deletion.value),newWsSuffix=trailingWs(deletion.value),newWsPrefix=longestCommonPrefix(oldWsPrefix,oldWsSuffix),deletion.value=removePrefix(deletion.value,newWsPrefix),insertion=longestCommonSuffix(removePrefix(oldWsPrefix,newWsPrefix),newWsSuffix),deletion.value=removeSuffix(deletion.value,insertion),endKeep.value=replacePrefix(endKeep.value,oldWsPrefix,insertion),startKeep.value=replaceSuffix(startKeep.value,oldWsPrefix,oldWsPrefix.slice(0,oldWsPrefix.length-insertion.length))):endKeep?(ws=leadingWs(endKeep.value),overlap=maximumOverlap(trailingWs(deletion.value),ws),deletion.value=removeSuffix(deletion.value,overlap)):startKeep&&(overlap=maximumOverlap(trailingWs(startKeep.value),leadingWs(deletion.value)),deletion.value=removePrefix(deletion.value,overlap))}var wordsWithSpaceDiff=new((_super=>{function WordsWithSpaceDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends$5(WordsWithSpaceDiff,_super),WordsWithSpaceDiff.prototype.tokenize=function(value){var regex=new RegExp("(\\r?\\n)|[".concat(extendedWordChars,"]+|[^\\S\\n\\r]+|[^").concat(extendedWordChars,"]"),"ug");return value.match(regex)||[]},WordsWithSpaceDiff})(Diff));function diffWordsWithSpace(oldStr,newStr,options){return wordsWithSpaceDiff.diff(oldStr,newStr,options)}var __extends$4=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),lineDiff=new((_super=>{function LineDiff(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.tokenize=tokenize,_this}return __extends$4(LineDiff,_super),LineDiff.prototype.equals=function(left,right,options){return options.ignoreWhitespace?(options.newlineIsToken&&left.includes("\n")||(left=left.trim()),options.newlineIsToken&&right.includes("\n")||(right=right.trim())):options.ignoreNewlineAtEof&&!options.newlineIsToken&&(left.endsWith("\n")&&(left=left.slice(0,-1)),right.endsWith("\n"))&&(right=right.slice(0,-1)),_super.prototype.equals.call(this,left,right,options)},LineDiff})(Diff));function diffLines(oldStr,newStr,options){return lineDiff.diff(oldStr,newStr,options)}function tokenize(value,options){var retLines=[],linesAndNewlines=(value=options.stripTrailingCr?value.replace(/\r\n/g,"\n"):value).split(/(\n|\r\n)/);linesAndNewlines[linesAndNewlines.length-1]||linesAndNewlines.pop();for(var i=0;i<linesAndNewlines.length;i++){var line=linesAndNewlines[i];i%2&&!options.newlineIsToken?retLines[retLines.length-1]+=line:retLines.push(line)}return retLines}var __extends$3=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),sentenceDiff=new((_super=>{function SentenceDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends$3(SentenceDiff,_super),SentenceDiff.prototype.tokenize=function(value){return value.split(/(?<=[.!?])(\s+|$)/)},SentenceDiff})(Diff));var __extends$2=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),cssDiff=new((_super=>{function CssDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends$2(CssDiff,_super),CssDiff.prototype.tokenize=function(value){return value.split(/([{}:;,]|\s+)/)},CssDiff})(Diff));var __extends$1=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),jsonDiff=new((_super=>{function JsonDiff(){var _this=null!==_super&&_super.apply(this,arguments)||this;return _this.tokenize=tokenize,_this}return __extends$1(JsonDiff,_super),Object.defineProperty(JsonDiff.prototype,"useLongestToken",{get:function(){return!0},enumerable:!1,configurable:!0}),JsonDiff.prototype.castInput=function(value,options){var undefinedReplacement=options.undefinedReplacement,options=options.stringifyReplacer;return"string"==typeof value?value:JSON.stringify(canonicalize(value,null,null,void 0===options?function(k,v){return void 0===v?undefinedReplacement:v}:options),null,"  ")},JsonDiff.prototype.equals=function(left,right,options){return _super.prototype.equals.call(this,left.replace(/,([\r\n])/g,"$1"),right.replace(/,([\r\n])/g,"$1"),options)},JsonDiff})(Diff));function canonicalize(obj,stack,replacementStack,replacer,key){var i,canonicalizedObj;for(stack=stack||[],replacementStack=replacementStack||[],replacer&&(obj=replacer(void 0===key?"":key,obj)),i=0;i<stack.length;i+=1)if(stack[i]===obj)return replacementStack[i];if("[object Array]"===Object.prototype.toString.call(obj)){for(stack.push(obj),canonicalizedObj=new Array(obj.length),replacementStack.push(canonicalizedObj),i=0;i<obj.length;i+=1)canonicalizedObj[i]=canonicalize(obj[i],stack,replacementStack,replacer,String(i));stack.pop(),replacementStack.pop()}else if("object"==typeof(obj=obj&&obj.toJSON?obj.toJSON():obj)&&null!==obj){stack.push(obj),replacementStack.push(canonicalizedObj={});var key_1,sortedKeys=[];for(key_1 in obj)Object.prototype.hasOwnProperty.call(obj,key_1)&&sortedKeys.push(key_1);for(sortedKeys.sort(),i=0;i<sortedKeys.length;i+=1)canonicalizedObj[key_1=sortedKeys[i]]=canonicalize(obj[key_1],stack,replacementStack,replacer,key_1);stack.pop(),replacementStack.pop()}else canonicalizedObj=obj;return canonicalizedObj}var __extends=(()=>{var extendStatics=function(d,b){return(extendStatics=Object.setPrototypeOf||({__proto__:[]}instanceof Array?function(d,b){d.__proto__=b}:function(d,b){for(var p in b)Object.prototype.hasOwnProperty.call(b,p)&&(d[p]=b[p])}))(d,b)};return function(d,b){if("function"!=typeof b&&null!==b)throw new TypeError("Class extends value "+String(b)+" is not a constructor or null");function __(){this.constructor=d}extendStatics(d,b),d.prototype=null===b?Object.create(b):(__.prototype=b.prototype,new __)}})(),arrayDiff=new((_super=>{function ArrayDiff(){return null!==_super&&_super.apply(this,arguments)||this}return __extends(ArrayDiff,_super),ArrayDiff.prototype.tokenize=function(value){return value.slice()},ArrayDiff.prototype.join=function(value){return value},ArrayDiff.prototype.removeEmpty=function(value){return value},ArrayDiff})(Diff));var __assign$2=function(){return(__assign$2=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function parsePatch(uniDiff){var diffstr=uniDiff.split(/\n/),list=[],i=0;function parseIndex(){var index={};for(list.push(index);i<diffstr.length;){var line=diffstr[i];if(/^(---|\+\+\+|@@)\s/.test(line))break;var header=/^(?:Index:|diff(?: -r \w+)+)\s+(.+?)\s*$/.exec(line);header&&(index.index=header[1]),i++}for(parseFileHeader(index),parseFileHeader(index),index.hunks=[];i<diffstr.length;){line=diffstr[i];if(/^(Index:\s|diff\s|---\s|\+\+\+\s|===================================================================)/.test(line))break;if(/^@@/.test(line))index.hunks.push((()=>{var chunkHeaderIndex=i,chunkHeader=diffstr[i++].split(/@@ -(\d+)(?:,(\d+))? \+(\d+)(?:,(\d+))? @@/),hunk={oldStart:+chunkHeader[1],oldLines:void 0===chunkHeader[2]?1:+chunkHeader[2],newStart:+chunkHeader[3],newLines:void 0===chunkHeader[4]?1:+chunkHeader[4],lines:[]};0===hunk.oldLines&&(hunk.oldStart+=1),0===hunk.newLines&&(hunk.newStart+=1);for(var addCount=0,removeCount=0;i<diffstr.length&&(removeCount<hunk.oldLines||addCount<hunk.newLines||null!=(_a=diffstr[i])&&_a.startsWith("\\"));i++){var _a=0==diffstr[i].length&&i!=diffstr.length-1?" ":diffstr[i][0];if("+"!==_a&&"-"!==_a&&" "!==_a&&"\\"!==_a)throw new Error("Hunk at line ".concat(chunkHeaderIndex+1," contained invalid line ").concat(diffstr[i]));hunk.lines.push(diffstr[i]),"+"===_a?addCount++:"-"===_a?removeCount++:" "===_a&&(addCount++,removeCount++)}if(addCount||1!==hunk.newLines||(hunk.newLines=0),removeCount||1!==hunk.oldLines||(hunk.oldLines=0),addCount!==hunk.newLines)throw new Error("Added line count did not match for hunk at line "+(chunkHeaderIndex+1));if(removeCount===hunk.oldLines)return hunk;throw new Error("Removed line count did not match for hunk at line "+(chunkHeaderIndex+1))})());else{if(line)throw new Error("Unknown line "+(i+1)+" "+JSON.stringify(line));i++}}}function parseFileHeader(index){var header,data,fileHeader=/^(---|\+\+\+)\s+(.*)\r?$/.exec(diffstr[i]);fileHeader&&(header=((data=fileHeader[2].split("\t",2))[1]||"").trim(),data=data[0].replace(/\\\\/g,"\\"),/^".*"$/.test(data)&&(data=data.substr(1,data.length-2)),"---"===fileHeader[1]?(index.oldFileName=data,index.oldHeader=header):(index.newFileName=data,index.newHeader=header),i++)}for(;i<diffstr.length;)parseIndex();return list}function applyPatch(source,patch,options){if(void 0===options&&(options={}),1<(patch="string"==typeof patch?parsePatch(patch):Array.isArray(patch)?patch:[patch]).length)throw new Error("applyPatch only works with a single input.");return((source,patch,options)=>{!(options=void 0===options?{}:options).autoConvertLineEndings&&null!=options.autoConvertLineEndings||((string=>string.includes("\r\n")&&!string.startsWith("\n")&&!string.match(/[^\r]\n/))(source)&&(patch=>!(patch=Array.isArray(patch)?patch:[patch]).some(function(index){return index.hunks.some(function(hunk){return hunk.lines.some(function(line){return!line.startsWith("\\")&&line.endsWith("\r")})})}))(patch)?patch=function unixToWin(patch){return Array.isArray(patch)?patch.map(unixToWin):__assign$2(__assign$2({},patch),{hunks:patch.hunks.map(function(hunk){return __assign$2(__assign$2({},hunk),{lines:hunk.lines.map(function(line,i){return line.startsWith("\\")||line.endsWith("\r")||null!=(i=hunk.lines[i+1])&&i.startsWith("\\")?line:line+"\r"})})})})}(patch):(string=>!string.includes("\r\n")&&string.includes("\n"))(source)&&(patch=>(patch=Array.isArray(patch)?patch:[patch]).some(function(index){return index.hunks.some(function(hunk){return hunk.lines.some(function(line){return line.endsWith("\r")})})})&&patch.every(function(index){return index.hunks.every(function(hunk){return hunk.lines.every(function(line,i){return line.startsWith("\\")||line.endsWith("\r")||(null==(line=hunk.lines[i+1])?void 0:line.startsWith("\\"))})})}))(patch)&&(patch=function winToUnix(patch){return Array.isArray(patch)?patch.map(winToUnix):__assign$2(__assign$2({},patch),{hunks:patch.hunks.map(function(hunk){return __assign$2(__assign$2({},hunk),{lines:hunk.lines.map(function(line){return line.endsWith("\r")?line.substring(0,line.length-1):line})})})})}(patch)));var lines=source.split("\n"),hunks=patch.hunks,compareLine=options.compareLine||function(lineNumber,line,operation,patchContent){return line===patchContent},fuzzFactor=options.fuzzFactor||0,minLine=0;if(fuzzFactor<0||!Number.isInteger(fuzzFactor))throw new Error("fuzzFactor must be a non-negative integer");if(!hunks.length)return source;for(var prevLine="",removeEOFNL=!1,addEOFNL=!1,i=0;i<hunks[hunks.length-1].lines.length;i++)"\\"==(line=hunks[hunks.length-1].lines[i])[0]&&("+"==prevLine[0]?removeEOFNL=!0:"-"==prevLine[0]&&(addEOFNL=!0)),prevLine=line;if(removeEOFNL){if(addEOFNL){if(!fuzzFactor&&""==lines[lines.length-1])return!1}else if(""==lines[lines.length-1])lines.pop();else if(!fuzzFactor)return!1}else if(addEOFNL)if(""!=lines[lines.length-1])lines.push("");else if(!fuzzFactor)return!1;for(var resultLines=[],prevHunkOffset=0,i=0;i<hunks.length;i++){for(var hunk=hunks[i],hunkResult=void 0,maxLine=lines.length-hunk.oldLines+fuzzFactor,toPos=void 0,maxErrors=0;maxErrors<=fuzzFactor;maxErrors++){for(var iterator=((start,minLine,maxLine)=>{var wantForward=!0,backwardExhausted=!1,forwardExhausted=!1,localOffset=1;return function iterator(){if(wantForward&&!forwardExhausted){if(backwardExhausted?localOffset++:wantForward=!1,start+localOffset<=maxLine)return start+localOffset;forwardExhausted=!0}if(!backwardExhausted)return forwardExhausted||(wantForward=!0),minLine<=start-localOffset?start-localOffset++:(backwardExhausted=!0,iterator())}})(toPos=hunk.oldStart+prevHunkOffset-1,minLine,maxLine);void 0!==toPos&&!(hunkResult=function applyHunk(hunkLines,toPos,maxErrors,hunkLinesI,lastContextLineMatched,patchedLines,patchedLinesLength){void 0===hunkLinesI&&(hunkLinesI=0),void 0===lastContextLineMatched&&(lastContextLineMatched=!0),void 0===patchedLines&&(patchedLines=[]),void 0===patchedLinesLength&&(patchedLinesLength=0);for(var nConsecutiveOldContextLines=0,nextContextLineMustMatch=!1;hunkLinesI<hunkLines.length;hunkLinesI++){var operation=0<(hunkLine=hunkLines[hunkLinesI]).length?hunkLine[0]:" ",hunkLine=0<hunkLine.length?hunkLine.substr(1):hunkLine;if("-"===operation){if(!compareLine(toPos+1,lines[toPos],operation,hunkLine))return maxErrors&&null!=lines[toPos]?(patchedLines[patchedLinesLength]=lines[toPos],applyHunk(hunkLines,toPos+1,maxErrors-1,hunkLinesI,!1,patchedLines,patchedLinesLength+1)):null;toPos++,nConsecutiveOldContextLines=0}if("+"===operation){if(!lastContextLineMatched)return null;patchedLines[patchedLinesLength]=hunkLine,patchedLinesLength++,nextContextLineMustMatch=!(nConsecutiveOldContextLines=0)}if(" "===operation){if(nConsecutiveOldContextLines++,patchedLines[patchedLinesLength]=lines[toPos],!compareLine(toPos+1,lines[toPos],operation,hunkLine))return nextContextLineMustMatch||!maxErrors?null:lines[toPos]&&(applyHunk(hunkLines,toPos+1,maxErrors-1,hunkLinesI+1,!1,patchedLines,patchedLinesLength+1)||applyHunk(hunkLines,toPos+1,maxErrors-1,hunkLinesI,!1,patchedLines,patchedLinesLength+1))||applyHunk(hunkLines,toPos,maxErrors-1,hunkLinesI+1,!1,patchedLines,patchedLinesLength);patchedLinesLength++,nextContextLineMustMatch=!(lastContextLineMatched=!0),toPos++}}return toPos-=nConsecutiveOldContextLines,patchedLines.length=patchedLinesLength-=nConsecutiveOldContextLines,{patchedLines:patchedLines,oldLineLastI:toPos-1}}(hunk.lines,toPos,maxErrors));toPos=iterator());if(hunkResult)break}if(!hunkResult)return!1;for(var i_1=minLine;i_1<toPos;i_1++)resultLines.push(lines[i_1]);for(var i_2=0;i_2<hunkResult.patchedLines.length;i_2++){var line=hunkResult.patchedLines[i_2];resultLines.push(line)}minLine=hunkResult.oldLineLastI+1,prevHunkOffset=toPos+1-hunk.oldStart}for(i=minLine;i<lines.length;i++)resultLines.push(lines[i]);return resultLines.join("\n")})(source,patch[0],options)}var __assign$1=function(){return(__assign$1=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};var __assign=function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};function structuredPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options){var options=options?"function"==typeof options?{callback:options}:options:{},context=(void 0===options.context&&(options.context=4),options.context);if(options.newlineIsToken)throw new Error("newlineIsToken may not be used with patch-generation functions, only with diffing functions");if(!options.callback)return diffLinesResultToPatch(diffLines(oldStr,newStr,options));var callback_1=options.callback;function diffLinesResultToPatch(diff){if(diff){diff.push({value:"",lines:[]});for(var hunks=[],oldRangeStart=0,newRangeStart=0,curRange=[],oldLine=1,newLine=1,i=0;i<diff.length;i++){var current=diff[i],lines=current.lines||(text=>{var hasTrailingNl=text.endsWith("\n"),text=text.split("\n").map(function(line){return line+"\n"});return hasTrailingNl?text.pop():text.push(text.pop().slice(0,-1)),text})(current.value);if(current.lines=lines,current.added||current.removed){!oldRangeStart&&(oldRangeStart=oldLine,newRangeStart=newLine,prev=diff[i-1])&&(oldRangeStart-=(curRange=0<context?contextLines(prev.lines.slice(-context)):[]).length,newRangeStart-=curRange.length);for(var _i=0,lines_1=lines;_i<lines_1.length;_i++){var line=lines_1[_i];curRange.push((current.added?"+":"-")+line)}current.added?newLine+=lines.length:oldLine+=lines.length}else{if(oldRangeStart)if(lines.length<=2*context&&i<diff.length-2)for(var _a=0,_b=contextLines(lines);_a<_b.length;_a++){line=_b[_a];curRange.push(line)}else{for(var prev=Math.min(lines.length,context),_c=0,_d=contextLines(lines.slice(0,prev));_c<_d.length;_c++){line=_d[_c];curRange.push(line)}var hunk={oldStart:oldRangeStart,oldLines:oldLine-oldRangeStart+prev,newStart:newRangeStart,newLines:newLine-newRangeStart+prev,lines:curRange};hunks.push(hunk),newRangeStart=oldRangeStart=0,curRange=[]}oldLine+=lines.length,newLine+=lines.length}}for(var _e=0,hunks_1=hunks;_e<hunks_1.length;_e++)for(hunk=hunks_1[_e],i=0;i<hunk.lines.length;i++)hunk.lines[i].endsWith("\n")?hunk.lines[i]=hunk.lines[i].slice(0,-1):(hunk.lines.splice(i+1,0,"\\ No newline at end of file"),i++);return{oldFileName:oldFileName,newFileName:newFileName,oldHeader:oldHeader,newHeader:newHeader,hunks:hunks}}function contextLines(lines){return lines.map(function(entry){return" "+entry})}}diffLines(oldStr,newStr,__assign(__assign({},options),{callback:function(diff){diff=diffLinesResultToPatch(diff);callback_1(diff)}}))}function formatPatch(patch){if(Array.isArray(patch))return patch.map(formatPatch).join("\n");var ret=[];patch.oldFileName==patch.newFileName&&ret.push("Index: "+patch.oldFileName),ret.push("==================================================================="),ret.push("--- "+patch.oldFileName+(void 0===patch.oldHeader?"":"\t"+patch.oldHeader)),ret.push("+++ "+patch.newFileName+(void 0===patch.newHeader?"":"\t"+patch.newHeader));for(var i=0;i<patch.hunks.length;i++){var hunk=patch.hunks[i];0===hunk.oldLines&&--hunk.oldStart,0===hunk.newLines&&--hunk.newStart,ret.push("@@ -"+hunk.oldStart+","+hunk.oldLines+" +"+hunk.newStart+","+hunk.newLines+" @@");for(var _i=0,_a=hunk.lines;_i<_a.length;_i++){var line=_a[_i];ret.push(line)}}return ret.join("\n")+"\n"}function createTwoFilesPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options){if(null!=(options="function"==typeof options?{callback:options}:options)&&options.callback){var callback_2=options.callback;structuredPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,__assign(__assign({},options),{callback:function(patchObj){callback_2(patchObj?formatPatch(patchObj):void 0)}}))}else{oldFileName=structuredPatch(oldFileName,newFileName,oldStr,newStr,oldHeader,newHeader,options);if(oldFileName)return formatPatch(oldFileName)}}exports.Diff=Diff,exports.applyPatch=applyPatch,exports.applyPatches=function(uniDiff,options){var spDiff="string"==typeof uniDiff?parsePatch(uniDiff):uniDiff,currentIndex=0;!function processIndex(){var index=spDiff[currentIndex++];if(!index)return options.complete();options.loadFile(index,function(err,data){if(err)return options.complete(err);err=applyPatch(data,index,options),options.patched(index,err,function(err){if(err)return options.complete(err);processIndex()})})}()},exports.arrayDiff=arrayDiff,exports.canonicalize=canonicalize,exports.characterDiff=characterDiff,exports.convertChangesToDMP=function(changes){for(var change,operation,ret=[],i=0;i<changes.length;i++)operation=(change=changes[i]).added?1:change.removed?-1:0,ret.push([operation,change.value]);return ret},exports.convertChangesToXML=function(changes){for(var ret=[],i=0;i<changes.length;i++){var change=changes[i];change.added?ret.push("<ins>"):change.removed&&ret.push("<del>"),ret.push(change.value.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")),change.added?ret.push("</ins>"):change.removed&&ret.push("</del>")}return ret.join("")},exports.createPatch=function(fileName,oldStr,newStr,oldHeader,newHeader,options){return createTwoFilesPatch(fileName,fileName,oldStr,newStr,oldHeader,newHeader,options)},exports.createTwoFilesPatch=createTwoFilesPatch,exports.cssDiff=cssDiff,exports.diffArrays=function(oldArr,newArr,options){return arrayDiff.diff(oldArr,newArr,options)},exports.diffChars=function(oldStr,newStr,options){return characterDiff.diff(oldStr,newStr,options)},exports.diffCss=function(oldStr,newStr,options){return cssDiff.diff(oldStr,newStr,options)},exports.diffJson=function(oldStr,newStr,options){return jsonDiff.diff(oldStr,newStr,options)},exports.diffLines=diffLines,exports.diffSentences=function(oldStr,newStr,options){return sentenceDiff.diff(oldStr,newStr,options)},exports.diffTrimmedLines=function(oldStr,newStr,options){return options=((options,defaults)=>{if("function"==typeof options)defaults.callback=options;else if(options)for(var name in options)Object.prototype.hasOwnProperty.call(options,name)&&(defaults[name]=options[name]);return defaults})(options,{ignoreWhitespace:!0}),lineDiff.diff(oldStr,newStr,options)},exports.diffWords=function(oldStr,newStr,options){return null==(null==options?void 0:options.ignoreWhitespace)||options.ignoreWhitespace?wordDiff.diff(oldStr,newStr,options):diffWordsWithSpace(oldStr,newStr,options)},exports.diffWordsWithSpace=diffWordsWithSpace,exports.formatPatch=formatPatch,exports.jsonDiff=jsonDiff,exports.lineDiff=lineDiff,exports.parsePatch=parsePatch,exports.reversePatch=function reversePatch(structuredPatch){return Array.isArray(structuredPatch)?structuredPatch.map(reversePatch).reverse():__assign$1(__assign$1({},structuredPatch),{oldFileName:structuredPatch.newFileName,oldHeader:structuredPatch.newHeader,newFileName:structuredPatch.oldFileName,newHeader:structuredPatch.oldHeader,hunks:structuredPatch.hunks.map(function(hunk){return{oldLines:hunk.newLines,oldStart:hunk.newStart,newLines:hunk.oldLines,newStart:hunk.oldStart,lines:hunk.lines.map(function(l){return l.startsWith("-")?"+".concat(l.slice(1)):l.startsWith("+")?"-".concat(l.slice(1)):l})}})})},exports.sentenceDiff=sentenceDiff,exports.structuredPatch=structuredPatch,exports.wordDiff=wordDiff,exports.wordsWithSpaceDiff=wordsWithSpaceDiff});